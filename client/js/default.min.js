(function(){function a(){var a;I=r;for(a=0;a<F[h];a+=1)F[a]();F=[]}function b(){var b;M=r;I||a();for(b=0;b<G[h];b+=1)G[b]();G=[]}function c(a,b){var c;for(c=b[h]-1;0<=c;--c)a(b[c])}function d(a){return a[u](/-\w/g,function(a){return a.charAt(1)[w]()})}function g(a,b){return a[H]?a[H][d(b)]:x[C]?x[C](a,p).getPropertyValue(b):p}function k(a,b){return encodeURIComponent(a)[u](/%20/g,"+")+"="+encodeURIComponent(b)[u](/%20/g,"+")}function t(a){a[f][e]="";g(a,e)===q&&(a[f][e]="block")}function l(a){a=a.reverse();
1===a[h]&&(a=a[0]);return a}function y(a){var b="",f,e,p;if(a[z]===Object)for(f in a){if(a.hasOwnProperty(f))if(a[f][z]===Array)for(e=0;e<a[f][h];e+=1)b+=A+k(f,a[f][e]);else b+=A+k(f,a[f])}else c(function(a){if("FORM"===a[J])for(e=0;e<a.elements[h];e+=1)if(f=a.elements[e],!f.disabled)switch(f.type){case "button":case "image":case "file":case "submit":case "reset":break;case "select-one":0<f[h]&&(b+=A+k(f[D],f[n]));break;case "select-multiple":for(p=0;p<f[h];p+=1)f[p][E]&&(b+=A+k(f[D],f[p][n]));break;
case K:case L:f[B]&&(b+=A+k(f[D],f[n]));break;default:b+=A+k(f[D],f[n])}},a);return 0<b[h]?b.substring(1):""}var r=!0,h="length",u="replace",w="toUpperCase",H="currentStyle",C="getComputedStyle",p=null,f="style",e="display",q="none",z="constructor",A="&",J="nodeName",D="name",n="value",E="selected",K="checkbox",L="radio",B="checked",F=[],G=[],I=!1,M=!1,N=0,v=document,x=window;v.addEventListener?(v.addEventListener("DOMContentLoaded",a,!1),x.addEventListener("load",b,!1)):v.attachEvent?(v.attachEvent("onreadystatechange",
a),x.attachEvent("onload",b)):x.onload=b;x.$=function(a){var b,m=[];b=!1;var z,k;if(a)if(a.nodeType&&1===a.nodeType)m=[a];else if("object"==typeof a)b="number"!=typeof a[h],m=a;else if("string"===typeof a)for(v.querySelectorAll||(v.querySelectorAll=function(a){var b,c=v.getElementsByTagName("head")[0],f=[],e;b=v.createElement("STYLE");b.type="text/css";if(b.styleSheet){b.styleSheet.cssText=a+" {a:b}";c.appendChild(b);a=v.getElementsByTagName("*");for(e=0;e<a[h];e+=1)"b"===g(a[e],"a")&&f.push(a[e]);
c.removeChild(b)}return f}),z=v.querySelectorAll(a),k=0;k<z[h];k+=1)m[k]=z[k];b=b?{}:m;b.ready=function(a){a&&(I?a():F.push(a))};b.loaded=function(a){a&&(M?a():G.push(a))};b.loop=function(a){"function"==typeof a&&c(function(b){return a.apply(b,arguments)},m)};b.find=function(a){if(a){var b=[];switch(a){case "first":0<m[h]&&(m=[m.shift()]);break;case "last":0<m[h]&&(m=[m.pop()]);break;case "odd":case "even":for(a="odd"===a?0:1;a<m[h];a+=2)b.push(m[a]);m=b}}return 0<m[h]?1===m[h]?m[0]:m:!1};b.hide=
function(){c(function(a){a[f][e]=q},m)};b.show=function(){c(function(a){t(a)},m)};b.toggle=function(){c(function(a){g(a,e)===q?t(a):a[f][e]=q},m)};b.remove=function(){c(function(a){try{a.parentNode.removeChild(a)}catch(b){}},m);m=[]};b.css=function(a,b){var e=[];c(function(c){if(b)try{c[f][d(a)]=b}catch(h){}else c[f][d(a)]?e.push(c[f][d(a)]):g(c,a)?e.push(g(c,a)):e.push(p)},m);if(0<e[h])return l(e)};b.cls=function(a,b){var f=[],e,p,d,g,q;a&&(e=a.split(/\s+/),b=b||u);c(function(c){p=c.className;if(a){switch(b){case "add":c.className=
p+" "+a;break;case u:c.className=a;break;case "has":case "toggle":case "remove":g=r;for(q=0;q<e[h];q+=1)if(d=new RegExp("\\b"+e[q]+"\\b","g"),"has"===b){if(!p.match(d)){g=!1;break}}else"toggle"===b?c.className=c.className.match(d)?c.className[u](d,""):c.className+" "+e[q]:c.className=c.className[u](d,"");"has"===b&&f.push(g)}c.className=c.className[u](/^\s+|\s+$/g,"")}else f.push(p)},m);if(0<f[h])return l(f)};b.html=function(a,b){var f=[],e,d;c(function(c){if(b)for(e=v.createElement("div"),e.innerHTML=
a;(d=e.lastChild)!==p;)try{"before"===b?c.parentNode.insertBefore(d,c):"after"===b?c.parentNode.insertBefore(d,c.nextSibling):"append"===b?c.appendChild(d):"prepend"===b&&c.insertBefore(d,c.firstChild)}catch(g){break}else a?c.innerHTML=a:f.push(c.innerHTML)},m);if(0<f[h])return l(f)};b.attr=function(a,b){var e=[];c(function(c){if(a)switch(a=a.toLowerCase(),a){case f:b?c[f].cssText=b:c[f].cssText?e.push(c[f].cssText):e.push(p);break;case "class":b?c.className=b:c.className?e.push(c.className):e.push(p);
break;default:b?c.setAttribute(a,b):c.getAttribute(a)?e.push(c.getAttribute(a)):e.push(p)}},m);if(0<e[h])return l(e)};b.val=function(a){var b=[],f=[],e,d,g,q;"string"===typeof a&&(a=[a]);c(function(c){if(a)switch(c[J]){case "SELECT":for(e=0;e<c[h];e+=1)for(d=0;d<a[h];d+=1)if(c[e][E]="",c[e][n]===a[d]){c[e][E]=E;break}break;case "INPUT":switch(c.type){case K:case L:c[B]="";for(e=0;e<a[h];e+=1)if(c[n]===a[e]){c[B]=B;break}break;default:c[n]=a[0]}break;case "TEXTAREA":case "BUTTON":c[n]=a[0]}else switch(c[J]){case "SELECT":q=
f[h];f.push([]);for(e=0;e<c[h];e+=1)c[e][E]&&f[q].push(c[e][n]);switch(f[q][h]){case 0:f[q]=p;break;case 1:f[q]=f[q][0]}break;case "INPUT":switch(c.type){case K:c[B]?f.push(c[n]):f.push(p);break;case L:g=!1;for(e=0;e<b[h];e+=1)b[e][0]===c[D]&&(c[B]&&(f[b[e][1]]=c[n]),g=r);g||(b.push([c[D],f[h]]),c[B]?f.push(c[n]):f.push(p));break;default:f.push(c[n])}break;case "TEXTAREA":case "BUTTON":f.push(c[n])}},m);if(0<f[h])return l(f)};b.on=function(b,f,e){if(a===x||a===v)m=[a];c(function(a){v.addEventListener?
e?a.removeEventListener(b,f,!1):a.addEventListener(b,f,!1):v.attachEvent&&(e?(a.detachEvent("on"+b,a[b+f]),a[b+f]=p):(a[b+f]=function(){return f.apply(a,arguments)},a.attachEvent("on"+b,a[b+f])))},m)};b.ajax=function(a,b,c,f,e){var d,g=y(m),q=-1===a.indexOf("?")?"?":A,h=RegExp("http[s]?://(.*?)/","gi").exec(a),z="_ts="+ +new Date,k=v.getElementsByTagName("head")[0],l="chibi"+ +new Date+(N+=1),n;!e&&h&&x.location.host!==h[1]?(a+=q+g,f&&(a+=A+z),a=a[u]("=%3F","=?"),c&&-1!==a.indexOf("=?")&&(a=a[u]("=?",
"="+l),x[l]=function(a){try{c(a,200)}catch(b){}x[l]=void 0}),n=document.createElement("script"),n.async=r,n.src=a,n.onload=function(){k.removeChild(n)},k.appendChild(n)):(b=b||"GET",x.XMLHttpRequest?d=new XMLHttpRequest:x.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP")),d&&(b=b[w](),"GET"===b&&(a+=q+g,g=p),f&&(a+="POST"===b?q+z:A+z),d.open(b,a,r),d.onreadystatechange=function(){4===d.readyState&&c&&c(d.responseText,d.status)},"POST"===b&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),
e&&d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.send(g)))};return b}})();!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var g=["opacity",b,~~(100*a),c,d].join("-");c=.01+c/d*100;d=Math.max(1-(1-a)/b*(100-c),a);var h=r.substring(0,r.indexOf("Animation")).toLowerCase();return u[g]||(w.insertRule("@"+
(h&&"-"+h+"-"||"")+"keyframes "+g+"{0%{opacity:"+d+"}"+c+"%{opacity:"+a+"}"+(c+.01)+"%{opacity:1}"+(c+b)%100+"%{opacity:"+a+"}100%{opacity:"+d+"}}",w.cssRules.length),u[g]=1),g}function d(a,b){var c,d,g=a.style;b=b.charAt(0).toUpperCase()+b.slice(1);for(d=0;d<h.length;d++)if(c=h[d]+b,void 0!==g[c])return c;return void 0!==g[b]?b:void 0}function g(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function k(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)void 0===a[d]&&(a[d]=
c[d])}return a}function t(a,b){return"string"==typeof a?a:a[b%a.length]}function l(a){this.opts=k(a||{},l.defaults,H)}function y(){function c(b,e){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}w.addRule(".spin-vml","behavior:url(#default#VML)");l.prototype.lines=function(a,e){function d(){return g(c("group",{coordsize:r+" "+r,coordorigin:-l+" "+-l}),{width:r,height:r})}function h(a,f,k){b(n,b(g(d(),{rotation:360/e.lines*a+"deg",left:~~f}),b(g(c("roundrect",{arcsize:e.corners}),
{width:l,height:e.width,left:e.radius,top:-e.width>>1,filter:k}),c("fill",{color:t(e.color,a),opacity:e.opacity}),c("stroke",{opacity:0}))))}var k,l=e.length+e.width,r=2*l;k=2*-(e.width+e.length)+"px";var n=g(d(),{position:"absolute",top:k,left:k});if(e.shadow)for(k=1;k<=e.lines;k++)h(k,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(k=1;k<=e.lines;k++)h(k);return b(a,n)};l.prototype.opacity=function(a,b,c,d){a=a.firstChild;d=d.shadow&&d.lines||0;a&&b+
d<a.childNodes.length&&(a=a.childNodes[b+d],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=c))}}var r,h=["webkit","Moz","ms","O"],u={},w=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),H={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",position:"absolute"};l.defaults={};k(l.prototype,{spin:function(b){this.stop();
var c=this,e=c.opts,d=c.el=g(a(0,{className:e.className}),{position:e.position,width:0,zIndex:e.zIndex});e.radius+e.length+e.width;if(g(d,{left:e.left,top:e.top}),b&&b.insertBefore(d,b.firstChild||null),d.setAttribute("role","progressbar"),c.lines(d,c.opts),!r){var h,k=0,l=(e.lines-1)*(1-e.direction)/2,t=e.fps,n=t/e.speed,u=(1-e.opacity)/(n*e.trail/100),w=n/e.lines;!function B(){k++;for(var a=0;a<e.lines;a++)h=Math.max(1-(k+(e.lines-a)*w)%n*u,e.opacity),c.opacity(d,a*e.direction+l,h,e);c.timeout=
c.el&&setTimeout(B,~~(1E3/t))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function e(b,c){return g(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var h,k=0,l=(f.lines-1)*(1-f.direction)/
2;k<f.lines;k++)h=g(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:r&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(h,g(e("#000","0 0 4px #000"),{top:"2px"})),b(d,b(h,e(t(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var C=g(a("group"),{behavior:"url(#default#VML)"});return!d(C,"transform")&&
C.adj?y():r=d(C,"animation"),l});(function(){var a=a||{};a.PAGE="index";a.RPAGE="";a.LOGIN=!1;a.CACHE=null;a.SPINNER=null;a.SE_CLICK_ORDER=0;a.SE_CHANGES=!1;a.init=function(){$("body").on("click",function(b){if("BUTTON"==b.target.nodeName&&"btn-menu"==b.target.id)a.btnMenuHandler();else if("A"==b.target.nodeName&&/^nv-/.test(b.target.id))a.PAGE=b.target.id.substr(3),a.PAGE="home"==a.PAGE?"index":a.PAGE,a.navbarHandler(a.PAGE);else if("DIV"==b.target.nodeName&&/^alert/.test(b.target.className))$(b.target).hide();else{switch(a.PAGE){case "index":a.indexHandler(b);
break;case "login":a.loginHandler(b);break;case "events":a.eventsHandler(b);break;case "scorecard-edit":a.scorecardEditHandler(b);break;case "scorecard-history":a.scorecardHistoryHandler(b);break;case "scorecard-upload":a.scorecardUploadHandler(b);break;case "cache-clear":a.cacheClearHandler(b);break;default:return}"block"==$("#navbar").css("display")&&a.btnMenuHide()}});$("body").on("keyup",function(b){"INPUT"!=b.target.nodeName||"username"!=b.target.id&&"password"!=b.target.id||a.validateLoginInput()});
a.restoreStorageCache();a.restoreClickOrder();a.loadPage(a.PAGE)};a.navbarHandler=function(b){a.loadPage(b);a.btnMenuHide()};a.btnMenuHandler=function(){var b=$("#navbar");""==b.css("display")||"none"==b.css("display")?a.btnMenuShow():a.btnMenuHide()};a.indexHandler=function(b){"BUTTON"==b.target.nodeName&&"btn-i-reop"==b.target.id?(a.PAGE="scorecard-edit",a.loadPage(a.PAGE)):"BUTTON"==b.target.nodeName&&"btn-i-down"==b.target.id&&(a.PAGE="events",a.loadPage(a.PAGE))};a.loginHandler=function(b){if("BUTTON"==
b.target.nodeName&&"btn-login"==b.target.id&&a.validateLoginInput()){a.startLoader();var c=$("#username"),d=$("#password");$({username:c.val(),password:d.val()}).ajax("../server/?action=login","POST",function(b,k){200==k?(b=JSON.parse(b),200==b.status?(a.LOGIN=!0,a.PAGE=""!=a.RPAGE?a.RPAGE:"index",a.RPAGE="",a.loadPage(a.PAGE)):(a.LOGIN=!1,a.styleLoginInput(!1,c[0].parentNode),a.styleLoginInput(!1,d[0].parentNode))):a.setAlert("alert-danger","Connection failed.");a.stopLoader()},!0)}};a.eventsHandler=
function(b){"BUTTON"==b.target.nodeName&&"btn-download"==b.target.id&&(b=$("#sel-events")[0],b=parseInt(b[b.selectedIndex].value),0<b&&(a.startLoader(),$({eid:b}).ajax("../server/?action=getEvent","GET",function(b,d){if(200==d){var g=a.getNowTimestamp();b=JSON.parse(b);200==b.status?(a.CACHE=b.data,a.CACHE["ts-cli-rx"]=g,a.saveStorageCache(),a.SE_CHANGES=!1,a.SE_CLICK_ORDER=0,a.PAGE="scorecard-edit",a.loadPage(a.PAGE),a.setAlert("alert-success","Event saved to local.")):401==b.status?(a.RPAGE="events",
a.PAGE="login",a.loadPage(a.PAGE)):a.setAlert("alert-danger","Connection failed.")}else a.setAlert("alert-danger","Connection failed.");a.stopLoader()},!0)))};a.scorecardEditHandler=function(b){if("BUTTON"==b.target.nodeName&&/^btn-click-/.test(b.target.id)){var c=parseInt(b.target.id.substr(10));0<=c&&c<a.CACHE.scorecard.length&&(b=$(b.target),null==a.CACHE.scorecard[c].pp&&b.cls("btn-primary","has")?(a.SE_CLICK_ORDER++,a.CACHE.scorecard[c].pp=a.SE_CLICK_ORDER,a.CACHE.scorecard[c].pt=a.getNowTimestamp(),
a.SE_CHANGES=!0,a.styleSeBtnSave(a.SE_CHANGES),a.styleSeBtnBack(0<a.SE_CLICK_ORDER),a.styleSeBtnRst(0<a.SE_CLICK_ORDER),a.styleClickTableBtn("#btn-click-"+c,["btn-default","disabled"])):null!=a.CACHE.scorecard[c].pp&&b.cls("btn-success","has")&&(b=a.CACHE.scorecard[c].pp,a.CACHE.scorecard[c].pp=null,a.CACHE.scorecard[c].pt=null,a.recalcClickOrder(b),a.SE_CLICK_ORDER--,a.SE_CHANGES=!0,a.styleSeBtnSave(a.SE_CHANGES),a.styleSeBtnBack(0<a.SE_CLICK_ORDER),a.styleSeBtnRst(0<a.SE_CLICK_ORDER),a.syncCacheClickTableBtns()))}else if("BUTTON"==
b.target.nodeName&&/^btn-se-(back|rst|save)$/.test(b.target.id))switch(b.target.id){case "btn-se-back":c=a.getClickOrderCachePosition(a.SE_CLICK_ORDER);0<=c&&c<a.CACHE.scorecard.length&&(a.CACHE.scorecard[c].pp=null,a.CACHE.scorecard[c].pt=null,a.SE_CLICK_ORDER--,a.SE_CHANGES=!0,a.styleSeBtnSave(a.SE_CHANGES),a.styleSeBtnBack(0<a.SE_CLICK_ORDER),a.styleSeBtnRst(0<a.SE_CLICK_ORDER),a.syncCacheClickTableBtns());break;case "btn-se-rst":a.enableResetBtns(!0);a.styleSeBtnBack(!1);a.styleSeBtnRst(!1);a.styleSeBtnSave(!1);
break;case "btn-se-save":a.saveStorageCache(),a.SE_CHANGES=!1,a.styleSeBtnSave(a.SE_CHANGES),a.styleSeBtnBack(0<a.SE_CLICK_ORDER),a.styleSeBtnRst(0<a.SE_CLICK_ORDER)}};a.scorecardHistoryHandler=function(b){"BUTTON"==b.target.nodeName&&/^btn-sh-back$/.test(b.target.id)&&(a.PAGE="scorecard-edit",a.loadPage(a.PAGE))};a.scorecardUploadHandler=function(b){if("BUTTON"==b.target.nodeName&&/^btn-su-(save|up|reop)$/.test(b.target.id))switch(b.target.id){case "btn-su-save":a.saveStorageCache();a.SE_CHANGES=
!1;a.PAGE="scorecard-upload";a.loadPage(a.PAGE);break;case "btn-su-up":0==a.SE_CHANGES&&(a.restoreStorageCache(),a.getLocation());break;case "btn-su-reop":a.PAGE="scorecard-edit",a.loadPage(a.PAGE)}};a.cacheClearHandler=function(b){"BUTTON"==b.target.nodeName&&"btn-cc-confirm"==b.target.id?(a.clearStorageCache(),a.CACHE=null,a.PAGE="cache-clear",a.loadPage(a.PAGE),a.setAlert("alert-success","Local cache was cleared.")):"BUTTON"!=b.target.nodeName||"btn-cc-home"!=b.target.id&&"btn-cc-index"!=b.target.id||
(a.PAGE="index",a.loadPage(a.PAGE))};a.loadPage=function(b){$("div[id^=pg-]").cls("hide","remove");$("div[id^=pg-]").cls("hide","add");$("#pg-"+b).cls("hide","remove");"login"!=b&&($("#navbar li").cls("active","remove"),$("#nv-"+b)[0].parentNode.className="active");a.stopLoader();switch(b){case "index":a.indexLoader();break;case "login":a.loginLoader();break;case "events":a.eventsLoader();break;case "scorecard-edit":a.scorecardEditLoader();break;case "scorecard-history":a.scorecardHistoryLoader();
break;case "scorecard-upload":a.scorecardUploadLoader();break;case "cache-clear":a.cacheClearLoader()}};a.indexLoader=function(){null!=a.CACHE?($("#cont-i-reopen").show(),$("#cont-i-download").hide(),$("#sp-i-reop-etitle").html(a.CACHE.name+" ("+a.CACHE.station+")")):($("#cont-i-reopen").hide(),$("#cont-i-download").show())};a.loginLoader=function(){$("#username").val("");$("#password").val("");a.validateLoginInput()};a.eventsLoader=function(){$("#sel-events").html('<option value="0">none</option>');
$().ajax("../server/?action=getEventList","GET",function(b,c){if(200==c)if(b=JSON.parse(b),200==b.status){for(var d="",g=0;g<b.data.length;g++)d+="<option value="+b.data[g].id+">"+b.data[g].name+"</option>";d+='<option value="0">none</option>';$("#sel-events").html(d);a.btnDisable(!1,"#btn-download")}else 401==b.status?(a.RPAGE="events",a.PAGE="login",a.loadPage(a.PAGE)):a.setAlert("alert-danger","Connection failed.");else a.setAlert("alert-danger","Connection failed.")},!0)};a.scorecardEditLoader=
function(){$("#cont-se-title").html(" ");$("#cont-se-clicker").html(" ");if(null==a.CACHE)a.setAlert("alert-danger","Empty local cache."),a.SE_CHANGES=!1,a.SE_CLICK_ORDER=0;else{$("#cont-se-title").html(a.CACHE.name+" ("+a.CACHE.station+")");var b=a.getDateFromTimestamp(a.getNowTimestamp()).getTime(),c=a.getDateFromTimestamp(a.CACHE["ts-ev-start"]).getTime(),d=a.getDateFromTimestamp(a.CACHE["ts-ev-end"]).getTime(),g=a.getDateFromTimestamp(a.CACHE["ts-srv-tx"]).getTime(),g=a.getDateFromTimestamp(a.CACHE["ts-cli-rx"]).getTime()-
g;b>=c+g&&b<=d+g?a.drawClickTable():(a.setAlert("alert-danger","Event is time blocked."),$("#cont-se-clicker").html('<div id="se-time-restriction"><p>You can edit this event in time range</p><p class="p-se-date">'+a.CACHE["ts-ev-start"]+'</p><p class="p-se-date">'+a.CACHE["ts-ev-end"]+"</p></div>"),a.SE_CHANGES=!1,a.SE_CLICK_ORDER=0)}a.styleSeBtnSave(a.SE_CHANGES);a.styleSeBtnBack(0<a.SE_CLICK_ORDER);a.styleSeBtnRst(0<a.SE_CLICK_ORDER)};a.scorecardHistoryLoader=function(){$("#cont-sh-order").html(" ");
if(null==a.CACHE)a.setAlert("alert-danger","Empty local cache.");else{var b=a.CACHE.scorecard.slice(0),c=0;b.sort(function(a,b){return b.pp-a.pp});for(var d=0;d<b.length;d++)if(null!=b[d].pp)c++;else break;b=b.slice(0,c);a.drawHistoryTable(b)}};a.scorecardUploadLoader=function(){null==a.CACHE?($("#cont-su-upload").hide(),$("#cont-su-save").hide(),a.setAlert("alert-danger","Empty local cache.")):a.SE_CHANGES?($("#cont-su-save").show(),$("#cont-su-upload").hide()):($("#cont-su-save").hide(),$("#cont-su-upload").show())};
a.cacheClearLoader=function(){null!=a.CACHE?($("#cont-cc-nemtpy").show(),$("#cont-cc-emtpy").hide()):($("#cont-cc-nemtpy").hide(),$("#cont-cc-emtpy").show())};a.getViewport=function(){var a=window,c="inner";"innerWidth"in window||(c="client",a=document.documentElement||document.body);return{width:a[c+"Width"],height:a[c+"Height"]}};a.getDateFromTimestamp=function(a){a=a.match(/^(\d{4})\-(\d{2})\-(\d{2}) (\d{2})\:(\d{2})\:(\d{2})$/);var c=new Date;c.setUTCFullYear(a[1]);c.setUTCMonth(a[2]-1);c.setUTCDate(a[3]);
c.setUTCHours(a[4],a[5],a[6],0);return c};a.drawHistoryTable=function(a){var c=document.createElement("TABLE"),d=document.createElement("THEAD"),g=document.createElement("TBODY");c.id="historyTable";c.className="table";var k=document.createElement("TR"),t=document.createElement("TH"),l=document.createElement("TH");t.innerHTML="Num.";l.innerHTML="Time";k.appendChild(t);k.appendChild(l);d.appendChild(k);for(t=0;t<a.length;t++){var k=document.createElement("TR"),l=document.createElement("TD"),y=document.createElement("TD"),
r=document.createTextNode(a[t].sn),h=document.createTextNode(a[t].pt);l.className="col-0";y.className="col-1";l.appendChild(r);y.appendChild(h);k.appendChild(l);k.appendChild(y);g.appendChild(k)}c.appendChild(d);c.appendChild(g);document.getElementById("cont-sh-order").appendChild(c)};a.uploadCacheString=function(){var b=a.getStorageCacheString();!1!==b&&$({data:b}).ajax("../server/?action=updateEvent","POST",function(b,d){200==d?(b=JSON.parse(b),200==b.status?(a.CACHE=null,a.clearStorageCache(),
a.SE_CHANGES=!1,a.SE_CLICK_ORDER=0,a.PAGE="index",a.loadPage(a.PAGE),a.setAlert("alert-success","Event uploaded to server.")):401==b.status?(a.RPAGE="scorecard-upload",a.PAGE="login",a.loadPage(a.PAGE)):a.setAlert("alert-danger","Connection failed.")):a.setAlert("alert-danger","Connection failed.");a.stopLoader()},!0)};a.getLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(a.saveLocation,a.errorLocation):a.setAlert("alert-danger","Geolocation is not supported.")};
a.saveLocation=function(b){a.CACHE.gps.lat=b.coords.latitude;a.CACHE.gps.lng=b.coords.longitude;a.CACHE.gps.alt=b.coords.altitude;a.CACHE.gps.ts=b.timestamp;a.saveStorageCache();a.uploadCacheString()};a.errorLocation=function(b){switch(b.code){case b.PERMISSION_DENIED:a.setAlert("alert-danger","User denied the request for Geolocation.");break;case b.POSITION_UNAVAILABLE:a.setAlert("alert-danger","Location information is unavailable.");break;case b.TIMEOUT:a.setAlert("alert-danger","The request to get user location timed out.");
break;case b.UNKNOWN_ERROR:a.setAlert("alert-danger","An unknown error occurred.")}};a.getNowTimestamp=function(){var a=new Date,a=a.toISOString();return a=a.substr(0,10)+" "+a.substr(11,8)};a.getClickOrderCachePosition=function(b){if(null!=a.CACHE.scorecard){for(var c=0;c<a.CACHE.scorecard.length;c++)if(a.CACHE.scorecard[c].pp==b)return c;return-1}};a.styleSeBtnBack=function(a){a?$("#btn-se-back").cls("disabled","remove"):($("#btn-se-back").cls("disabled","remove"),$("#btn-se-back").cls("disabled",
"add"))};a.styleSeBtnRst=function(a){a?$("#btn-se-rst").cls("disabled","remove"):($("#btn-se-rst").cls("disabled","remove"),$("#btn-se-rst").cls("disabled","add"))};a.recalcClickOrder=function(b){if(null!=a.CACHE.scorecard)for(var c=0;c<a.CACHE.scorecard.length;c++)a.CACHE.scorecard[c].pp>b&&a.CACHE.scorecard[c].pp--};a.enableResetBtns=function(b){for(var c=0;c<a.CACHE.scorecard.length;c++)b?null!=a.CACHE.scorecard[c].pp?a.styleClickTableBtn("#btn-click-"+c,["btn-success"]):a.styleClickTableBtn("#btn-click-"+
c,["btn-default","disabled"]):null!=a.CACHE.scorecard[c].pp?a.styleClickTableBtn("#btn-click-"+c,["btn-default","disabled"]):a.styleClickTableBtn("#btn-click-"+c,["btn-primary"])};a.syncCacheClickTableBtns=function(){if(null!=a.CACHE.scorecard)for(var b=0;b<a.CACHE.scorecard.length;b++){var c=null==a.CACHE.scorecard[b].pp;a.styleClickTableBtn("#btn-click-"+b,[c?"":"disabled",c?"btn-primary":"btn-default"])}};a.styleClickTableBtn=function(a,c){var d=$(a);d.cls("btn-default","remove");d.cls("btn-primary",
"remove");d.cls("btn-success","remove");d.cls("disabled","remove");for(var g=0;g<c.length;g++)d.cls(c[g],"add")};a.restoreClickOrder=function(){a.SE_CLICK_ORDER=a.getLastClickOrder()};a.getLastClickOrder=function(){var b=0;if(null!=a.CACHE)for(var c=0;c<a.CACHE.scorecard.length;c++)a.CACHE.scorecard[c].pp>b&&(b=a.CACHE.scorecard[c].pp);return b};a.styleSeBtnSave=function(a){a?($("#btn-se-save").cls("disabled","remove"),$("#btn-se-save").cls("btn-default","remove"),$("#btn-se-save").cls("btn-danger",
"add")):($("#btn-se-save").cls("disabled","remove"),$("#btn-se-save").cls("btn-danger","remove"),$("#btn-se-save").cls("disabled","add"),$("#btn-se-save").cls("btn-default","add"))};a.drawClickTable=function(){var b=document.createElement("TABLE");b.id="clickTable";b.style.width="100%";for(var c=0,d=5*Math.floor($("#cont-se-clicker")[0].clientWidth/300),d=0>=d?5:d,g=Math.ceil(a.CACHE.scorecard.length/d),k=0;k<g;k++){for(var t=document.createElement("TR"),l=0;l<d;l++,c++){var y=document.createElement("TD");
y.style.padding="5px";if(a.CACHE.scorecard[c]){var r=null==a.CACHE.scorecard[c].pp?"":"disabled",h=null==a.CACHE.scorecard[c].pp?"btn-primary":"btn-default",u=document.createTextNode(a.CACHE.scorecard[c].sn),w=document.createElement("BUTTON");w.id="btn-click-"+c;w.className="btn btn-lg "+h+" "+r;w.style.width="100%";w.appendChild(u);y.appendChild(w)}t.appendChild(y)}b.appendChild(t)}document.getElementById("cont-se-clicker").appendChild(b)};a.setAlert=function(a,c){var d=$("#alert-box");d.cls("alert-success",
"remove");d.cls("alert-info","remove");d.cls("alert-warning","remove");d.cls("alert-danger","remove");d.cls(a,"add");d.html(c);d.show();window.setTimeout(function(){d.hide()},3E3)};a.getStorageCacheString=function(){if("undefined"!=typeof Storage)return localStorage.getItem("mxCache");a.setAlert("alert-danger","Storage cache not supported.");return!1};a.saveStorageCache=function(){"undefined"!=typeof Storage?localStorage.setItem("mxCache",JSON.stringify(a.CACHE)):a.setAlert("alert-danger","Storage cache not supported.")};
a.restoreStorageCache=function(){"undefined"!=typeof Storage?a.CACHE=JSON.parse(localStorage.getItem("mxCache")):a.setAlert("alert-danger","Storage cache not supported.")};a.clearStorageCache=function(){"undefined"!=typeof Storage?localStorage.setItem("mxCache",null):a.setAlert("alert-danger","Storage cache not supported.")};a.isStorageCacheEmpty=function(){return"undefined"!=typeof Storage&&null!=localStorage.getItem("mxCache")?!1:!0};a.startLoader=function(){var b=$("#loader");null==a.SPINNER&&
(a.SPINNER=(new Spinner({lines:13,length:0,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2E9,top:"50%",left:"50%"})).spin(b[0]));b.show()};a.stopLoader=function(){var b=$("#loader");b.hide();b.html(" ");a.SPINNER=null};a.btnMenuShow=function(){$("#navbar").show();$("#navbar").css("visibility","visible");$("#btn-menu").css("background-color","#333")};a.btnMenuHide=function(){$("#navbar").hide();$("#navbar").css("visibility",
"hidden");$("#btn-menu").css("background-color","inherit")};a.btnDisable=function(a,c){a?($(c).cls("disabled","remove"),$(c).cls("disabled","add")):$(c).cls("disabled","remove")};a.styleLoginInput=function(a,c){a?($(c).cls("has-success","remove"),$(c).cls("has-error","remove"),$(c).cls("has-success","add")):($(c).cls("has-success","remove"),$(c).cls("has-error","remove"),$(c).cls("has-error","add"))};a.validateLoginInput=function(){var b=$("#username"),c=$("#password"),d=!1;"undefined"!=b.val()&&
/^[a-zA-Z0-9,\.-]{5,50}$/.test(b.val())?a.styleLoginInput(!0,b[0].parentNode):a.styleLoginInput(!1,b[0].parentNode);"undefined"!=c.val()&&/^[a-zA-Z0-9,\.-]{5,50}$/.test(c.val())?(a.styleLoginInput(!0,c[0].parentNode),d=!0):(a.styleLoginInput(!1,c[0].parentNode),d=!1);d?a.btnDisable(!1,"#btn-login"):a.btnDisable(!0,"#btn-login");return d};a.init()})();